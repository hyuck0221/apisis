<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('AI 분석 - APIsis')}">
</head>
<head>
    <link rel="stylesheet" th:href="@{/css/analytics.css}">
</head>
<body class="light-mode">
    <!-- 사이드바 -->
    <aside th:replace="~{fragments/layout :: sidebar}"></aside>

    <!-- 오버레이 (모바일용) -->
    <div th:replace="~{fragments/layout :: overlay}"></div>

    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <!-- 모바일 헤더 -->
        <header th:replace="~{fragments/layout :: header}"></header>

        <!-- 콘텐츠 래퍼 -->
        <div class="content-wrapper">
            <!-- 페이지 헤더 -->
            <div class="page-header mb-4">
                <h1 class="page-title">AI 분석</h1>
                <p class="page-subtitle">인공지능이 분석한 API 사용 패턴과 인사이트를 확인하세요</p>
            </div>

            <!-- 분석 설정 안내 -->
            <div class="analytics-disabled-state" th:if="${analyticsSetting == null || !analyticsSetting.enabled}">
                <div class="disabled-icon">⚙️</div>
                <h2 class="disabled-title">AI 분석이 비활성화되어 있습니다</h2>
                <p class="disabled-description">
                    AI 분석 기능을 사용하려면 설정에서 분석 기능을 활성화해주세요.<br>
                    활성화하시면 인공지능이 여러분의 API 사용 패턴을 분석하여 맞춤형 인사이트를 제공합니다.
                </p>
                <div class="disabled-actions">
                    <a href="/settings" class="btn-primary-link">
                        <span>설정으로 이동</span>
                        <span style="margin-left: 8px;">→</span>
                    </a>
                </div>
                <div class="disabled-features">
                    <div class="feature-item">
                        <div class="feature-icon">📈</div>
                        <div class="feature-text">
                            <div class="feature-title">사용 패턴 분석</div>
                            <div class="feature-desc">API 호출 패턴과 트렌드 분석</div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">💡</div>
                        <div class="feature-text">
                            <div class="feature-title">최적화 제안</div>
                            <div class="feature-desc">성능 개선을 위한 맞춤 제안</div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🎯</div>
                        <div class="feature-text">
                            <div class="feature-title">이상 탐지</div>
                            <div class="feature-desc">비정상적인 패턴 자동 감지</div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🔮</div>
                        <div class="feature-text">
                            <div class="feature-title">예측 분석</div>
                            <div class="feature-desc">미래 사용량 예측 및 권장사항</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 분석 보고서 표시 -->
            <div class="analytics-report-container" th:if="${analyticsSetting != null && analyticsSetting.enabled}" style="display: none;">
                <div class="report-controls">
                    <div class="report-selector-wrapper">
                        <div class="report-selector">
                            <label for="reportSelect" class="report-label">분석 보고서 선택</label>
                            <select id="reportSelect" class="report-select">
                                <option value="">보고서를 선택해주세요</option>
                            </select>
                        </div>
                        <button class="btn-delete-report" id="deleteReportBtn" onclick="deleteCurrentReport()" style="display: none;">
                            이 보고서 삭제
                        </button>
                    </div>
                </div>
                <div class="report-viewer" id="reportViewer" style="display: none;">
                    <iframe id="reportIframe" class="report-iframe" frameborder="0" scrolling="no"></iframe>
                </div>
            </div>

            <!-- AI 데이터 수집 중 -->
            <div class="ai-collecting-state" th:if="${analyticsSetting != null && analyticsSetting.enabled}">
                <div class="collecting-icon">
                    🤖
                </div>
                <h2 class="collecting-title">AI가 데이터를 수집하고 있습니다</h2>
                <p class="collecting-description">
                    인공지능이 여러분의 API 사용 패턴을 분석하고 있습니다.<br>
                    충분한 데이터가 수집되면 맞춤형 인사이트와 추천을 제공해드립니다.
                </p>
                <div class="collecting-features">
                    <div class="feature-item">
                        <div class="feature-icon">📈</div>
                        <div class="feature-text">
                            <div class="feature-title">사용 패턴 분석</div>
                            <div class="feature-desc">API 호출 패턴과 트렌드 분석</div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">💡</div>
                        <div class="feature-text">
                            <div class="feature-title">최적화 제안</div>
                            <div class="feature-desc">성능 개선을 위한 맞춤 제안</div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🎯</div>
                        <div class="feature-text">
                            <div class="feature-title">이상 탐지</div>
                            <div class="feature-desc">비정상적인 패턴 자동 감지</div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🔮</div>
                        <div class="feature-text">
                            <div class="feature-title">예측 분석</div>
                            <div class="feature-desc">미래 사용량 예측 및 권장사항</div>
                        </div>
                    </div>
                </div>
                <div class="collecting-info">
                    <p>💡 API를 더 많이 사용할수록 더 정확한 분석 결과를 받아보실 수 있습니다.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 스크립트 -->
    <th:block th:replace="~{fragments/layout :: scripts}"></th:block>
    <script th:src="@{/js/analytics.js}"></script>
</body>
</html>
