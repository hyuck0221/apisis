<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('API 키 관리 - APIsis')}">
</head>
<head>
    <link rel="stylesheet" th:href="@{/css/api-keys.css}">
</head>
<body class="light-mode">
    <!-- 사이드바 -->
    <aside th:replace="~{fragments/layout :: sidebar}"></aside>

    <!-- 오버레이 (모바일용) -->
    <div th:replace="~{fragments/layout :: overlay}"></div>

    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <!-- 모바일 헤더 -->
        <header th:replace="~{fragments/layout :: header}"></header>

        <!-- 콘텐츠 래퍼 -->
        <div class="content-wrapper">
            <!-- 페이지 헤더 -->
            <div class="page-header mb-4">
                <div class="header-content">
                    <div>
                        <h1 class="page-title">API 키 관리</h1>
                        <p class="page-subtitle">각 API 키의 사용량과 통계를 확인하세요</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-refresh" onclick="refreshStats()" title="새로고침">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                        </button>
                        <div class="refresh-progress-container">
                            <div class="refresh-progress-bar" id="refreshProgressBar"></div>
                        </div>
                        <button class="btn-primary" onclick="showCreateModal()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>새 API 키 생성</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- API 키 목록 -->
            <div class="page-container">
                <div id="apiKeyStatsList" class="api-key-stats-list">
                    <!-- API 키 통계 목록이 여기에 동적으로 로드됩니다 -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>API 키 통계 로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- API 키 생성 모달 -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 API 키 생성</h3>
                <button class="modal-close" onclick="closeCreateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="keyName">키 이름</label>
                    <input type="text" id="keyName" placeholder="예: My First API Key" class="form-input">
                    <small>이 API 키의 용도를 설명하는 이름을 입력하세요</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeCreateModal()">취소</button>
                <button class="btn-primary" onclick="createApiKey()">생성</button>
            </div>
        </div>
    </div>

    <!-- API 키 이름 수정 모달 -->
    <div id="editNameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API 키 이름 수정</h3>
                <button class="modal-close" onclick="closeEditNameModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editKeyValue">
                <div class="form-group">
                    <label for="editKeyName">키 이름</label>
                    <input type="text" id="editKeyName" placeholder="새로운 키 이름" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeEditNameModal()">취소</button>
                <button class="btn-primary" onclick="updateKeyName()">수정</button>
            </div>
        </div>
    </div>

    <!-- 스크립트 -->
    <th:block th:replace="~{fragments/layout :: scripts}"></th:block>
    <script th:src="@{/js/api-keys.js}"></script>
</body>
</html>
